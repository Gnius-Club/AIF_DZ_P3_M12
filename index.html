<!DOCTYPE html>
<html lang="es-MX">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Misi√≥n 12: El Estudio del Artista</title>
<style>
  /* ==========================
     DISE√ëO VISUAL (UX/UI 3¬∞ Primaria)
     ========================== */
  :root{
    --bg:#f0f4f8;
    --panel:#ffffff;
    --brand:#845ef7; /* Morado creativo */
    --accent:#20c997; /* Verde turquesa */
    --warn:#fcc419;
    --danger:#ff6b6b;
    --ink:#343a40;
    --radius:20px;
    --shadow:0 10px 30px rgba(0,0,0,0.1);
    --font-main: "Nunito", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  }

  /* Reset y Base */
  *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
  html,body{ height:100%; margin:0; overflow:hidden; }
  body{
    background:var(--bg); color:var(--ink); font-family:var(--font-main);
    display:flex; flex-direction:column;
  }

  /* Accesibilidad: Alto Contraste */
  body.high-contrast{
    --bg:#fff; --panel:#000; --ink:#fff; --brand:#ffff00; --accent:#00ff00; --danger:#ff0000;
  }
  body.high-contrast .card, body.high-contrast .panel, body.high-contrast .btn { border: 2px solid #fff; }

  /* Encabezado */
  header{
    flex:0 0 60px; background:var(--brand); color:#fff; display:flex; align-items:center; justify-content:space-between; padding:0 16px; box-shadow:0 4px 12px rgba(0,0,0,0.15); z-index:10;
  }
  h1{ font-size:1.2rem; margin:0; display:flex; align-items:center; gap:8px; }
  
  /* Botones de control (Toggle) */
  .controls{ display:flex; gap:8px; }
  .tgl-btn{
    background:rgba(255,255,255,0.2); border:none; color:#fff; border-radius:50%; width:40px; height:40px; font-size:18px; cursor:pointer; display:grid; place-items:center; transition:0.2s;
  }
  .tgl-btn:hover{ background:rgba(255,255,255,0.4); }
  .tgl-btn[aria-pressed="false"]{ opacity:0.5; position:relative; }
  .tgl-btn[aria-pressed="false"]::after{ content:''; position:absolute; width:100%; height:2px; background:#fff; transform:rotate(45deg); }

  /* Pantallas */
  main{ flex:1; position:relative; overflow:hidden; }
  .screen{
    position:absolute; inset:0; display:none; flex-direction:column; padding:16px; overflow-y:auto; 
    animation: fadeIn 0.4s ease-out;
  }
  .screen.active{ display:flex; }
  @keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }

  /* Componentes Comunes */
  .card{
    background:var(--panel); border-radius:var(--radius); box-shadow:var(--shadow); padding:24px;
    margin:auto; max-width:900px; width:100%; text-align:center; position:relative;
  }
  .btn{
    background:var(--brand); color:#fff; border:none; padding:14px 28px; font-size:1.1rem; font-weight:bold;
    border-radius:50px; cursor:pointer; transition:transform 0.1s, filter 0.2s; box-shadow:0 4px 0 rgba(0,0,0,0.2);
    display:inline-flex; align-items:center; gap:8px; margin:8px;
  }
  .btn:active{ transform:translateY(4px); box-shadow:none; }
  .btn.secondary{ background:var(--accent); color:#004d40; }
  .btn.danger{ background:var(--danger); }
  
  /* --- PANTALLA INICIO --- */
  .hero-art{ font-size:80px; margin-bottom:10px; animation: float 3s infinite ease-in-out; }
  @keyframes float { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-15px);} }

  /* --- PANTALLA TUTORIAL (BRIEFING INTERACTIVO) --- */
  .tutorial-layout{ display:grid; grid-template-columns: 250px 1fr; gap:20px; text-align:left; align-items:center; height:100%; }
  .teacher-box{ 
    background:#ffe8cc; border-radius:var(--radius); padding:20px; text-align:center; height:100%; 
    display:flex; flex-direction:column; justify-content:center; align-items:center; border: 4px solid #fff; box-shadow:var(--shadow);
  }
  .teacher-avatar{ font-size:80px; background:#fff; border-radius:50%; width:120px; height:120px; display:grid; place-items:center; border:4px solid var(--ink); margin-bottom:10px; }
  .dialog-box{
    background:#fff; border-radius:var(--radius); padding:24px; position:relative; font-size:1.2rem; line-height:1.5; border:2px solid #eee;
  }
  .dialog-box::before{ content:""; position:absolute; left:-12px; top:50%; border:12px solid transparent; border-right-color:#fff; }
  
  /* Ejemplos Visuales del Tutorial */
  .example-container{ display:flex; gap:20px; justify-content:center; margin-top:20px; }
  .example-card{ 
    border:3px solid #ddd; border-radius:12px; padding:10px; width:140px; text-align:center; cursor:pointer; transition:0.2s; opacity:0.6; 
  }
  .example-card.selected{ border-color:var(--brand); opacity:1; transform:scale(1.05); background:#f0f0ff; }
  .example-card .emoji{ font-size:40px; }

  /* --- PANTALLA DE JUEGO (ESTUDIO) --- */
  .studio-grid{
    display:grid; grid-template-columns: 100px 1fr 240px; grid-template-rows: auto 1fr; gap:16px; height:100%;
  }
  /* HUD */
  .hud-bar{ grid-column:1/-1; display:flex; gap:16px; justify-content:center; padding:8px; background:#fff; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.05); }
  .meter{ display:flex; align-items:center; gap:6px; font-weight:bold; }
  .progress-bg{ width:100px; height:12px; background:#eee; border-radius:6px; overflow:hidden; border:1px solid #ccc; }
  .progress-fill{ height:100%; background:var(--accent); width:0%; transition:width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1); }
  
  /* Paleta */
  .palette-col{ display:flex; flex-direction:column; gap:8px; overflow-y:auto; padding-right:4px; }
  .tool-btn{
    background:#fff; border:2px solid #ddd; border-radius:12px; padding:8px; cursor:grab; text-align:center; transition:0.2s;
  }
  .tool-btn:hover{ border-color:var(--brand); background:#f8f9fa; }
  .tool-btn:active{ cursor:grabbing; }
  .tool-btn div{ font-size:28px; }
  .tool-btn span{ font-size:10px; font-weight:bold; display:block; }

  /* Lienzo */
  .canvas-area{
    background:#fff; border:4px dashed #ccc; border-radius:20px; position:relative; display:grid; place-items:center; overflow:hidden;
  }
  .canvas-area.dragover{ border-color:var(--brand); background:#f0f0ff; }
  .drop-zone-text{ color:#999; font-weight:bold; pointer-events:none; }
  .composition-layer{ position:absolute; inset:0; pointer-events:none; display:flex; flex-wrap:wrap; align-items:center; justify-content:center; gap:10px; }
  .comp-item{ font-size:60px; filter:drop-shadow(0 4px 4px rgba(0,0,0,0.2)); animation:popIn 0.3s; }
  @keyframes popIn{ from{transform:scale(0);} to{transform:scale(1);} }
  .style-overlay{ position:absolute; inset:0; mix-blend-mode:multiply; pointer-events:none; opacity:0.8; transition:0.3s; }

  /* Panel Derecho (Estilos y Acciones) */
  .actions-col{ display:flex; flex-direction:column; gap:12px; }
  .style-opt{
    background:#fff; border:2px solid #ddd; padding:10px; border-radius:12px; cursor:pointer; display:flex; align-items:center; gap:8px; text-align:left; font-size:0.9rem;
  }
  .style-opt.active{ border-color:var(--brand); background:#eef2ff; box-shadow:0 0 0 2px var(--brand); }
  .style-opt.trap{ border-color:var(--warn); }
  .style-opt.trap:hover::after{ content:"‚ö†Ô∏è Riesgo"; font-size:10px; color:var(--danger); font-weight:bold; margin-left:auto; }

  /* Acciones inferiores */
  .action-bar{ margin-top:auto; display:flex; flex-direction:column; gap:8px; }

  /* Modales */
  .modal-overlay{
    position:fixed; inset:0; background:rgba(0,0,0,0.6); display:none; place-items:center; z-index:100; backdrop-filter:blur(4px);
  }
  .modal-overlay.open{ display:grid; }
  .stamp{ 
    position:absolute; top:20px; right:20px; font-size:24px; font-weight:900; border:4px solid; padding:4px 10px; transform:rotate(-10deg); opacity:0; animation:stampIn 0.4s 0.5s forwards cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }
  .stamp.bad{ color:var(--danger); border-color:var(--danger); }
  .stamp.good{ color:var(--accent); border-color:var(--accent); }
  @keyframes stampIn{ from{opacity:0; transform:scale(2) rotate(-10deg);} to{opacity:1; transform:scale(1) rotate(-10deg);} }

  /* Subt√≠tulos */
  .captions{
    position:fixed; bottom:20px; left:50%; transform:translateX(-50%);
    background:rgba(0,0,0,0.8); color:#fff; padding:10px 20px; border-radius:20px;
    font-size:1.1rem; text-align:center; max-width:90%; pointer-events:none; z-index:50;
    transition: opacity 0.3s;
  }

  /* Responsivo */
  @media(max-width:768px){
    .tutorial-layout{ grid-template-columns:1fr; grid-template-rows: auto 1fr; gap:10px; }
    .teacher-box{ height:auto; padding:10px; flex-direction:row; gap:10px; }
    .teacher-avatar{ width:60px; height:60px; font-size:30px; margin:0; }
    .dialog-box::before{ display:none; }
    .studio-grid{ grid-template-columns: 1fr; grid-template-rows: auto auto 300px auto; overflow-y:auto; display:block; }
    .palette-col{ flex-direction:row; padding:10px 0; }
    .tool-btn{ min-width:60px; }
    .canvas-area{ height:300px; margin:10px 0; }
  }
</style>
</head>
<body>

<header>
  <h1>üé® El Estudio del Artista</h1>
  <div class="controls">
    <button class="tgl-btn" id="btnMusic" title="M√∫sica" aria-pressed="true">üéµ</button>
    <button class="tgl-btn" id="btnSfx" title="Sonidos" aria-pressed="true">üîä</button>
    <button class="tgl-btn" id="btnContrast" title="Alto Contraste" aria-pressed="false">üëÅÔ∏è</button>
  </div>
</header>

<!-- PANTALLA 1: INICIO -->
<main id="screen-start" class="screen active">
  <div class="card">
    <div class="hero-art">üë©‚Äçüé®‚ú®ü§ñ</div>
    <h2 style="color:var(--brand); font-size:2rem;">¬°Bienvenido a tu Galer√≠a!</h2>
    <p style="font-size:1.2rem; color:#555;">
      Aprende a crear con <strong>IA</strong> usando tu propia imaginaci√≥n.<br>
      Tu misi√≥n: Ganar fama sin hacer trampa.
    </p>
    <button class="btn" onclick="Game.startTutorial()">‚ñ∂Ô∏è Jugar</button>
  </div>
</main>

<!-- PANTALLA 2: TUTORIAL / BRIEFING (Interactivo) -->
<main id="screen-tutorial" class="screen">
  <div class="card tutorial-layout" style="max-width:1100px; background:transparent; box-shadow:none;">
    <div class="teacher-box">
      <div class="teacher-avatar">üë©‚Äçüè´</div>
      <div><strong>Maestra de Arte</strong></div>
    </div>
    
    <div class="dialog-box" id="tutorial-dialog">
      <!-- El contenido se inyecta por JS -->
    </div>
  </div>
</main>

<!-- PANTALLA 3: ESTUDIO (Juego Principal) -->
<main id="screen-studio" class="screen">
  <!-- HUD -->
  <div class="hud-bar">
    <div class="meter" title="Fans: Indica tu popularidad">
      ‚ù§Ô∏è <div class="progress-bg"><div id="bar-fans" class="progress-fill" style="background:#ff6b6b"></div></div>
      <span id="num-fans">0</span>
    </div>
    <div class="meter" title="Respeto: Lo m√°s importante">
      ‚≠ê <div class="progress-bg"><div id="bar-respect" class="progress-fill"></div></div>
      <span id="num-respect">50</span>
    </div>
  </div>

  <div class="studio-grid">
    <!-- Columna Izquierda: Ideas -->
    <div class="palette-col" id="idea-palette">
      <!-- Se generan con JS -->
    </div>

    <!-- Centro: Lienzo -->
    <div class="canvas-area" id="canvas-dropzone">
      <div class="drop-zone-text">
        Arrastra <strong>2 o m√°s</strong> ideas aqu√≠<br>para crear algo nuevo.
      </div>
      <div class="composition-layer" id="canvas-comp"></div>
      <div class="style-overlay" id="canvas-style"></div>
    </div>

    <!-- Columna Derecha: Estilos y Publicar -->
    <div class="actions-col">
      <strong>Elige un Estilo:</strong>
      <div id="style-list" style="display:flex; flex-direction:column; gap:8px;"></div>
      
      <div class="action-bar">
        <button class="btn secondary" id="btn-generate" disabled>üñåÔ∏è Generar Obra</button>
        <button class="btn" id="btn-publish" disabled>üì° Publicar</button>
        <button class="btn" id="btn-clear" style="background:#adb5bd; font-size:0.9rem;">‚ôªÔ∏è Limpiar</button>
      </div>
    </div>
  </div>
</main>

<!-- MODAL DETECTIVE -->
<div class="modal-overlay" id="modal-detective">
  <div class="card" style="border:4px solid var(--danger);">
    <div style="font-size:60px;">üïµÔ∏è‚Äç‚ôÇÔ∏è‚ö†Ô∏è</div>
    <h2 style="color:var(--danger)">¬°ALTO AH√ç!</h2>
    <div class="stamp bad">¬°PLAGIO!</div>
    <p>Has intentado copiar el estilo exacto de otro artista.</p>
    <p style="background:#fff0f0; padding:10px; border-radius:10px;">
      "Pedirle a la IA que 'dibuje como [Artista Famoso]' es robar su identidad. 
      La comunidad est√° decepcionada."
    </p>
    <div style="display:flex; justify-content:space-around; margin:20px 0; color:var(--danger); font-weight:bold;">
      <span>‚ù§Ô∏è Fans: -50</span>
      <span>‚≠ê Respeto: ROTO üíî</span>
    </div>
    <button class="btn" onclick="Game.closeModal('modal-detective')">Prometo ser original</button>
  </div>
</div>

<!-- MODAL RESULTADO -->
<div class="modal-overlay" id="modal-result">
  <div class="card">
    <div style="font-size:60px;" id="res-icon">üéâ</div>
    <h2 id="res-title">¬°Excelente Trabajo!</h2>
    <div class="stamp good" id="res-stamp">¬°ORIGINAL!</div>
    <p id="res-msg">Tu obra combina ideas √∫nicas.</p>
    <div style="display:flex; justify-content:center; gap:20px; margin:20px 0; font-weight:bold;">
      <span style="color:var(--danger)">‚ù§Ô∏è +<span id="gain-fans">0</span></span>
      <span style="color:var(--brand)">‚≠ê +<span id="gain-respect">0</span></span>
    </div>
    <button class="btn" onclick="Game.closeModal('modal-result')">Continuar</button>
  </div>
</div>

<!-- MODAL FIN DEL JUEGO -->
<div class="modal-overlay" id="modal-end">
  <div class="card">
    <h2>Fin del D√≠a de Galer√≠a</h2>
    <p id="end-msg">...</p>
    <button class="btn" onclick="location.reload()">üîÑ Jugar de Nuevo</button>
  </div>
</div>

<div class="captions" id="captions-box"></div>

<script>
/**
 * SISTEMA DE AUDIO
 * Maneja m√∫sica y efectos, asegurando que no queden loops infinitos.
 */
const AudioSys = {
  ctx: null,
  musicNode: null,
  sfxNode: null,
  settings: { music: true, sfx: true },

  init: function() {
    if(!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)();
  },

  playMusic: function() {
    if(!this.settings.music || !this.ctx) return;
    this.stopMusic();
    const osc = this.ctx.createOscillator();
    const gain = this.ctx.createGain();
    osc.type = 'triangle';
    osc.frequency.setValueAtTime(220, this.ctx.currentTime); // Nota base suave
    gain.gain.setValueAtTime(0.05, this.ctx.currentTime);
    
    // LFO para modulaci√≥n suave (tipo "ambient")
    const lfo = this.ctx.createOscillator();
    lfo.frequency.value = 0.2;
    const lfoGain = this.ctx.createGain();
    lfoGain.gain.value = 0.02;
    lfo.connect(lfoGain).connect(gain.gain);
    lfo.start();

    osc.connect(gain).connect(this.ctx.destination);
    osc.start();
    this.musicNode = { osc, lfo, gain };
  },

  stopMusic: function() {
    if(this.musicNode) {
      try {
        this.musicNode.osc.stop();
        this.musicNode.lfo.stop();
        this.musicNode.osc.disconnect();
      } catch(e){}
      this.musicNode = null;
    }
  },

  playSFX: function(type) {
    if(!this.settings.sfx || !this.ctx) return;
    this.ctx.resume();
    const t = this.ctx.currentTime;
    const osc = this.ctx.createOscillator();
    const gain = this.ctx.createGain();
    osc.connect(gain).connect(this.ctx.destination);

    if (type === 'pop') {
      osc.type = 'sine';
      osc.frequency.setValueAtTime(600, t);
      osc.frequency.exponentialRampToValueAtTime(100, t + 0.1);
      gain.gain.setValueAtTime(0.3, t);
      gain.gain.linearRampToValueAtTime(0, t + 0.1);
      osc.start(t); osc.stop(t + 0.1);
    } else if (type === 'success') {
      osc.type = 'triangle';
      osc.frequency.setValueAtTime(440, t);
      osc.frequency.setValueAtTime(554, t + 0.1); // C#
      osc.frequency.setValueAtTime(659, t + 0.2); // E
      gain.gain.setValueAtTime(0.1, t);
      gain.gain.linearRampToValueAtTime(0, t + 0.4);
      osc.start(t); osc.stop(t + 0.4);
    } else if (type === 'error') {
      // Sonido de error corto y grave
      osc.type = 'sawtooth';
      osc.frequency.setValueAtTime(150, t);
      osc.frequency.linearRampToValueAtTime(100, t + 0.3);
      gain.gain.setValueAtTime(0.3, t);
      gain.gain.linearRampToValueAtTime(0, t + 0.3);
      osc.start(t); osc.stop(t + 0.3);
    } else if (type === 'alarm') {
      // Alarma (Sirena) - Duraci√≥n controlada
      osc.type = 'square';
      osc.frequency.setValueAtTime(800, t);
      osc.frequency.linearRampToValueAtTime(600, t + 0.2);
      osc.frequency.linearRampToValueAtTime(800, t + 0.4);
      gain.gain.setValueAtTime(0.2, t);
      gain.gain.linearRampToValueAtTime(0, t + 0.8); // Se apaga sola en 0.8s
      osc.start(t); osc.stop(t + 0.8);
    }
  },

  stopAll: function() {
    this.stopMusic();
    // AudioContext.suspend() es dr√°stico, mejor dejar que los SFX cortos terminen.
  }
};

/**
 * DATOS DEL JUEGO
 */
const Data = {
  ideas: [
    {id:'robot', icon:'ü§ñ', name:'Robot'},
    {id:'tree', icon:'üå≥', name:'Bosque'},
    {id:'cat', icon:'üê±', name:'Gato'},
    {id:'rocket', icon:'üöÄ', name:'Espacio'},
    {id:'ocean', icon:'üê†', name:'Oc√©ano'},
    {id:'city', icon:'üèôÔ∏è', name:'Ciudad'}
  ],
  styles: [
    {id:'pixel', name:'Pixel Art', class:'pixel', risk: false},
    {id:'watercolor', name:'Acuarela Suave', class:'water', risk: false},
    {id:'neon', name:'Luces Ne√≥n', class:'neon', risk: false},
    {id:'famous', name:'Estilo "Van Gogh"', class:'trap', risk: true} // Trampa
  ],
  tutorialSteps: [
    {
      text: "¬°Hola Artista! Antes de usar la IA, debemos entender la regla de oro: <strong>Inspiraci√≥n vs. Plagio</strong>. ¬øEst√°s listo?",
      action: "next", btnText: "S√≠, estoy listo"
    },
    {
      text: "Mira estos cuadros. El original es el <strong>Gato Azul</strong> üê±üîµ.<br>Si t√∫ ves eso y pintas un <strong>Perro Azul</strong> üê∂üîµ, eso es...",
      options: [
        {label: "¬°Inspiraci√≥n! (Bien)", val: true, feedback: "¬°Exacto! Tomas la idea del color, pero creas tu propio personaje."},
        {label: "Trampa", val: false, feedback: "No, eso es inspiraci√≥n v√°lida. Cambiaste el tema."}
      ]
    },
    {
      text: "Pero si le pides a la IA que haga una copia exacta del Gato Azul, o que copie el estilo exacto de un artista famoso...",
      options: [
        {label: "Es un Homenaje", val: false, feedback: "Ten cuidado. A menudo eso se considera robar el trabajo de otro."},
        {label: "Es Plagio (Mal)", val: true, feedback: "¬°Correcto! Copiar no te ayuda a crecer y da√±a tu reputaci√≥n."}
      ]
    },
    {
      text: "¬°Bien hecho! Recuerda: Mezcla ideas (ü§ñ+üå≥) para ser original. Si solo copias, perder√°s el respeto de tus fans.",
      action: "start", btnText: "¬°Vamos al Estudio!"
    }
  ]
};

/**
 * L√ìGICA DEL JUEGO
 */
const Game = {
  state: { fans: 0, respect: 50, works: 0 },
  currentWork: { ideas: [], style: null },
  tutStep: 0,

  init: function() {
    this.bindEvents();
    this.renderPalette();
    this.renderStyles();
    this.updateHUD();
  },

  bindEvents: function() {
    // Audio Controls
    document.getElementById('btnMusic').onclick = (e) => {
      AudioSys.settings.music = !AudioSys.settings.music;
      e.currentTarget.setAttribute('aria-pressed', AudioSys.settings.music);
      if(AudioSys.settings.music) AudioSys.playMusic(); else AudioSys.stopMusic();
    };
    document.getElementById('btnSfx').onclick = (e) => {
      AudioSys.settings.sfx = !AudioSys.settings.sfx;
      e.currentTarget.setAttribute('aria-pressed', AudioSys.settings.sfx);
    };
    document.getElementById('btnContrast').onclick = () => document.body.classList.toggle('high-contrast');

    // Drag & Drop
    const zone = document.getElementById('canvas-dropzone');
    zone.addEventListener('dragover', (e) => { e.preventDefault(); zone.classList.add('dragover'); });
    zone.addEventListener('dragleave', () => zone.classList.remove('dragover'));
    zone.addEventListener('drop', (e) => {
      e.preventDefault(); zone.classList.remove('dragover');
      const id = e.dataTransfer.getData('text');
      this.addIdeaToCanvas(id);
    });

    // Buttons
    document.getElementById('btn-clear').onclick = () => this.clearCanvas();
    document.getElementById('btn-generate').onclick = () => this.generatePreview();
    document.getElementById('btn-publish').onclick = () => this.publishWork();
  },

  startTutorial: function() {
    AudioSys.init();
    AudioSys.playMusic();
    AudioSys.playSFX('pop');
    this.showScreen('screen-tutorial');
    this.runTutorialStep();
  },

  runTutorialStep: function() {
    const data = Data.tutorialSteps[this.tutStep];
    const container = document.getElementById('tutorial-dialog');
    container.innerHTML = `<p>${data.text}</p>`;

    if(data.action) {
      const btn = document.createElement('button');
      btn.className = 'btn';
      btn.textContent = data.btnText;
      btn.onclick = () => {
        AudioSys.playSFX('pop');
        if(data.action === 'next') { this.tutStep++; this.runTutorialStep(); }
        else { this.startStudio(); }
      };
      container.appendChild(btn);
    } else if(data.options) {
      const optsDiv = document.createElement('div');
      optsDiv.style.display = 'flex'; optsDiv.style.gap = '10px'; optsDiv.style.justifyContent = 'center'; optsDiv.style.marginTop = '16px';
      
      data.options.forEach(opt => {
        const b = document.createElement('button');
        b.className = 'btn secondary';
        b.textContent = opt.label;
        b.onclick = () => {
          if(opt.val) {
            AudioSys.playSFX('success');
            container.innerHTML = `<p style="color:var(--accent); font-weight:bold">${opt.feedback}</p>`;
            setTimeout(() => { this.tutStep++; this.runTutorialStep(); }, 2500);
          } else {
            AudioSys.playSFX('error');
            this.showCaption(opt.feedback);
          }
        };
        optsDiv.appendChild(b);
      });
      container.appendChild(optsDiv);
    }
  },

  startStudio: function() {
    this.showScreen('screen-studio');
    this.showCaption("Misi√≥n: Arrastra iconos al lienzo para crear una mezcla.");
  },

  renderPalette: function() {
    const el = document.getElementById('idea-palette');
    Data.ideas.forEach(item => {
      const div = document.createElement('div');
      div.className = 'tool-btn';
      div.draggable = true;
      div.innerHTML = `<div>${item.icon}</div><span>${item.name}</span>`;
      div.addEventListener('dragstart', (e) => {
        e.dataTransfer.setData('text', item.id);
        AudioSys.playSFX('pop');
      });
      // Click support for mobile
      div.onclick = () => this.addIdeaToCanvas(item.id);
      el.appendChild(div);
    });
  },

  renderStyles: function() {
    const el = document.getElementById('style-list');
    Data.styles.forEach(st => {
      const div = document.createElement('div');
      div.className = `style-opt ${st.class}`;
      div.textContent = st.name;
      div.onclick = () => {
        AudioSys.playSFX('pop');
        this.selectStyle(st);
        document.querySelectorAll('.style-opt').forEach(d => d.classList.remove('active'));
        div.classList.add('active');
      };
      el.appendChild(div);
    });
  },

  addIdeaToCanvas: function(id) {
    if(this.currentWork.ideas.length >= 4) {
      this.showCaption("¬°Demasiadas ideas! El lienzo est√° lleno.");
      return;
    }
    const item = Data.ideas.find(i => i.id === id);
    if(item && !this.currentWork.ideas.includes(id)) {
      this.currentWork.ideas.push(id);
      const span = document.createElement('span');
      span.className = 'comp-item';
      span.textContent = item.icon;
      document.getElementById('canvas-comp').appendChild(span);
      AudioSys.playSFX('pop');
      this.checkReady();
    }
  },

  selectStyle: function(styleObj) {
    this.currentWork.style = styleObj;
    // Visualizaci√≥n simple del estilo
    const overlay = document.getElementById('canvas-style');
    if(styleObj.id === 'pixel') overlay.style.background = 'repeating-linear-gradient(45deg, #eee 0 2px, transparent 2px 4px)';
    else if(styleObj.id === 'watercolor') overlay.style.background = 'radial-gradient(circle, rgba(255,200,200,0.3), rgba(200,200,255,0.3))';
    else if(styleObj.id === 'neon') overlay.style.background = 'linear-gradient(to bottom, #0001, #00f1)';
    else if(styleObj.id === 'famous') overlay.style.background = 'url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCI+PHRleHQgeT0iMTUiIGZvbnQtc2l6ZT0iMTIiIHN0eWxlPSJvcGFjaXR5OjAuMiI+4o6cPC90ZXh0Pjwvc3ZnPg==")'; // Patr√≥n tramposo
    
    this.checkReady();
  },

  checkReady: function() {
    const hasIdeas = this.currentWork.ideas.length > 0;
    const hasStyle = this.currentWork.style !== null;
    document.getElementById('btn-generate').disabled = !(hasIdeas && hasStyle);
    if(hasIdeas && hasStyle) document.getElementById('btn-generate').classList.remove('secondary');
  },

  generatePreview: function() {
    AudioSys.playSFX('pop');
    // Simula la IA trabajando
    this.showCaption("IA Generando... ü§ñ‚ú®");
    document.getElementById('btn-generate').disabled = true;
    setTimeout(() => {
      this.showCaption("¬°Obra lista para publicar!");
      document.getElementById('btn-publish').disabled = false;
      document.getElementById('btn-publish').focus();
    }, 1000);
  },

  publishWork: function() {
    const { ideas, style } = this.currentWork;
    const isOriginal = ideas.length >= 2;
    const isPlagiarism = style.risk; // Si eligi√≥ "Van Gogh"

    if(isPlagiarism) {
      this.handlePlagiarism();
    } else if(isOriginal) {
      this.handleSuccess("original");
    } else {
      // Solo 1 idea pero estilo seguro (Inspiraci√≥n b√°sica)
      this.handleSuccess("inspired");
    }
  },

  handleSuccess: function(type) {
    AudioSys.playSFX('success');
    let fanGain = 0, respectGain = 0;
    
    if(type === 'original') {
      fanGain = 50; respectGain = 25;
      document.getElementById('res-title').textContent = "¬°Obra Maestra!";
      document.getElementById('res-stamp').textContent = "¬°GENIAL!";
      document.getElementById('res-msg').textContent = "La comunidad ama tu originalidad.";
    } else {
      fanGain = 20; respectGain = 10;
      document.getElementById('res-title').textContent = "Buena Inspiraci√≥n";
      document.getElementById('res-stamp').textContent = "RESPONSABLE";
      document.getElementById('res-msg').textContent = "Has creado algo propio inspirado en una idea.";
    }

    this.updateStats(fanGain, respectGain);
    
    // UI Modal
    document.getElementById('gain-fans').textContent = fanGain;
    document.getElementById('gain-respect').textContent = respectGain;
    this.openModal('modal-result');
  },

  handlePlagiarism: function() {
    AudioSys.playSFX('alarm'); // Suena la alarma (se detiene sola)
    this.updateStats(-50, -50); // Penalizaci√≥n fuerte
    this.openModal('modal-detective');
  },

  updateStats: function(f, r) {
    this.state.fans = Math.max(0, this.state.fans + f);
    this.state.respect = Math.max(0, Math.min(100, this.state.respect + r));
    this.state.works++;
    this.updateHUD();
  },

  updateHUD: function() {
    document.getElementById('num-fans').textContent = this.state.fans;
    document.getElementById('num-respect').textContent = this.state.respect + '%';
    document.getElementById('bar-fans').style.width = Math.min(100, this.state.fans/5) + '%';
    document.getElementById('bar-respect').style.width = this.state.respect + '%';
    
    // Colores de barra de respeto
    const br = document.getElementById('bar-respect');
    if(this.state.respect < 30) br.style.background = 'var(--danger)';
    else if(this.state.respect < 70) br.style.background = 'var(--warn)';
    else br.style.background = 'var(--accent)';
  },

  clearCanvas: function() {
    this.currentWork = { ideas: [], style: null };
    document.getElementById('canvas-comp').innerHTML = '';
    document.getElementById('canvas-style').style.background = 'transparent';
    document.querySelectorAll('.style-opt').forEach(d => d.classList.remove('active'));
    document.getElementById('btn-publish').disabled = true;
    document.getElementById('btn-generate').disabled = true;
    this.showCaption("");
  },

  showScreen: function(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  },

  openModal: function(id) {
    document.getElementById(id).classList.add('open');
  },

  closeModal: function(id) {
    document.getElementById(id).classList.remove('open');
    this.clearCanvas();
    this.checkEndGame();
  },

  checkEndGame: function() {
    if(this.state.respect <= 0) {
      document.getElementById('end-msg').textContent = "Has perdido el respeto de la comunidad por copiar. Int√©ntalo siendo m√°s honesto.";
      this.openModal('modal-end');
    } else if(this.state.works >= 3) {
      document.getElementById('end-msg').textContent = `¬°Gran trabajo! Terminaste el d√≠a con ${this.state.fans} Fans y ${this.state.respect}% de Respeto.`;
      this.openModal('modal-end');
    }
  },

  showCaption: function(text) {
    const el = document.getElementById('captions-box');
    if(!text) { el.style.opacity = 0; return; }
    el.innerHTML = text;
    el.style.opacity = 1;
    setTimeout(() => el.style.opacity = 0, 4000);
  }
};

// Iniciar
window.onload = () => Game.init();
</script>
</body>
</html>
